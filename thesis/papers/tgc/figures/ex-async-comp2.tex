%!TEX root = ../main.tex
\begin{tikzpicture}[scale=0.675, every node/.style={transform shape}]

%%%%% Controller %%%%%
\node[mustt,rotate=0,label={left:$\trans{file?}$}] at (-2,-1) (filein) {};
\node[place,tokens=0] at (-1,-1) (p0) {};

\node[mustt,rotate=0,label={above:$\trans{gif!}$}] at (0,0) (gifout) {};
\node[mustt,rotate=0,label={above:$\trans{\outact{txt}}$}] at (0,-2) (txtout) {};

\node[place,tokens=0] at (1,0) (p1) {};
\node[place,tokens=0] at (1,-2) (p2) {};

\node[mustt,rotate=0,label={above:$\trans{jpg?}$}] at (2,0) (jpgin) {};
\node[mustt,rotate=0,label={right:$\trans{fail?}$}] at (1,-1) (fail) {};
\node[mustt,rotate=0,label={above:$\trans{\inact{zip}}$}] at (2,-2) (zipin) {};

\node[place,tokens=0] at (3,0) (p3) {};
\node[mustt,rotate=0,label={right:$\trans{comprJpg?}$}] at (4,0) (comprjpg) {};

\node[place,tokens=0] at (3,-2) (p4) {};
\node[mustt,rotate=0,label={right:$\trans{comprZip?}$}] at (4,-2) (comprzip) {};

\draw[arc] (filein) to[] (p0) {};

\draw[arc] (p0) to[bend left] (gifout) {};
\draw[arc] (p0) to[bend right] (txtout) {};

\draw[arc] (gifout) to[] (p1) {};
\draw[arc] (txtout) to[] (p2) {};

\draw[arc] (p1) to[] (jpgin) {};
\draw[arc] (p1) to[] (fail) {};
\draw[arc] (p2) to[] (zipin) {};

\draw[arc] (jpgin) to[] (p3) {};
\draw[arc] (fail) to[] (p0) {};
\draw[arc] (zipin) to[] (p4) {};

\draw[arc] (p3) to[] (comprjpg) {};
\draw[arc] (p4) to[] (comprzip) {};

%%%%% TxtCompressor %%%%%


\node[place,tokens=1] at (1,-6) (p5) {};

\node[mustt,rotate=0,label={left:$\trans{\inact{txt}}$}] at (0,-5) (txtin) {};
\node[place,tokens=0] at (1,-5) (p6) {};

\node[mustt,rotate=0,label={right:$\trans{\outact{zip}}$}] at (2,-5) (zipout) {};

\draw[arc] (p5) to[bend left] (txtin) {};
\draw[arc] (txtin) to[] (p6) {};
\draw[arc] (p6) to[] (zipout) {};
\draw[arc] (zipout.90) to[bend left] (p5) {};


%%%% Channels %%%%%
\node[place,tokens=0,label=left:$\trans{txt}$] at (0,-3.5) (txt) {};
\node[place,tokens=0,label=right:$\trans{zip}$] at (2,-3.5) (zip) {};
\draw[arc] (txtout) to[] (txt) {};
\draw[arc] (txt) to[] (txtin) {};
\draw[arc] (zipout) to[] (zip) {};
\draw[arc] (zip) to[] (zipin) {};

\end{tikzpicture}